head

div(id='pagewrap')

    header
        title Time and Radar US!
        link(href='https://fonts.googleapis.com/css?family=Orbitron:900' rel='stylesheet' type='text/css')
        link(rel='icon' href='/images/bbqBailey.png')
        link(rel='stylesheet' type='text/css' href='/stylesheets/threeCol.css')
        <meta http-equiv="refresh" content="600"/>

        
    section(id='topTime')
        div(id="time" ) Time: Waiting...
    
    section(id='topTemp')
        div(id="temp_f" ) 
    
    section(id='rader')
        div
            include ../public/images/conusForecastMap.html

    script(src="//code.jquery.com/jquery-2.1.4.min.js") 

    script.
        if(!!window.EventSource) {
            console.log('inside window.EventSource')
            var source = new EventSource('/eventEngine')
            console.log('after call to EventSource');
            source.addEventListener('open', function(e) {
                $("#state").text("Connected")
                console.log('open received')
            }, false)


            source.addEventListener('time', function(e) {
                console.log('eventListener: time: ', e);
                timeTemp = JSON.parse(e.data);
                console.log('time: ', timeTemp.time);
                $("#time").text(timeTemp.time);
                $("#temp_f").text(Math.round(timeTemp.temp_f));
                $("state").text(" Connected");
            })


            source.addEventListener('error', function(e) {
                console.log('eventlistener: error: ', e)
                if(e.target.readyState == EventSource.CLOSED) {
                    $("#temp_f").text("T");
                    $("#state").text(" Disconnected");
                    $("#station").text(" Disconnected");
                } else if (e.target.readyState == EventSource.CONNECTING) {
                    $("#temp_f").text("T");
                    $("#state").text("Connecting...");
                    $("#station").text("Station: Connecting...");
                }
            }, false)
        } else {
            console.log("Your browser doesn't support SSE")
        }






