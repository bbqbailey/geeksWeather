//output:output.html
head

div(id='mainArea')

  header
    title Time and Weather!
    link(href='https://fonts.googleapis.com/css?family=Orbitron:900' rel='stylesheet' type='text/css')
    link(rel='icon' href='/images/bbqBailey.png')
    link(rel='stylesheet' type='text/css' href='/stylesheets/detailedInfo.css')

        
  section(id='topTime')
    div(id="time" ) Time: Waiting...
    
  section(id='topTemp')
    div(id="temp_f" ) 
  
  section(id='today')
    div(id='today_high'  style='em') H: 
    div(id='today_low') L: 
    div(id='wind') W: 

    
  section(id='tomorrow')
    div(id='tmrw_high') H:
    div(id='tmrw_low') L: 
    div(id='tmrw_wind') W: 

  section(class='detailedInfo')
    div
      span(id='temp') Temp: 
      span(id='rel_hum') RH:
      span(id='wind_dir') WD:
      span(id='wind_mph') WS:
    div
      span(id='wind_gust') WG:
      span(id='press_mb') PM:
      span(id='press_trend') PT:
      span(id='dewpoint') DP:
    div
      span(id='visibility') VM:
      span(id='prec_1h') PH:
      span(id='prec_todayInch') PT:

    div
      //moon
      span(id='moon_pctIllum') MI:
      span(id='moon_ageOfMoon') MA:
      span(id='moon_phaseofMoon') MP:
      span(id='moon_hemisphere') MH:
    div
      span(id='moon_moonrise_hr') MRH:
      span(id='moon_moonrise_min') MRM:
      span(id='moon_moonset_hr') MSH:
      span(id='moon_moonset_min') MSM:

      //sun        
      span(id='sun_sunrise_hr') SRH:
      span(id='sun_sunrise_min') SRM:
      span(id='sun_sunset_hr') SSH:
      span(id='sun_sunset_min') SSM:

    div
      //forecast Tomorrow
      span(id='high') FH:
      span(id='low') FL:
      span(id='conditions') FC: 
      span(id='icon') FI:
    div
      span(id='pop') FP:
      span(id='qpf_allday') FA:
      span(id='qpf_day') FD:
      span(id='qpf_night') FN:
    div
      span(id='snow_allday') SA:
      span(id='snow_day') SD:
      span(id='snow_night') SN:
    div
      span(id='maxWindDegrees') MW:
      span(id='maxWindDir') MD:
      span(id='maxWindMph') MWM: 
    div
      span(id='aveWindDegrees') AW:
      span(id='aveWindDir') AD:
      span(id='aveWindMPph') AWM:
      span(id='avehumidity') FU:
      span(id='maxhumidity') MU:
      span(id='minhumidity') LU: 


  section(id='todayCond')
    div(id='cond')

  section(id='tomorrowCond')
    div(id='tmrw_cond')


  footer
    button(onclick='moveToHome()' class='pageSelection' id='homeButton' value='homeButton') Home
    div(id='state') State:
    div(id='station') Station:
 


  script(src="//code.jquery.com/jquery-2.1.4.min.js") 

  script.
    function moveToHome() {
        window.location.href = '/'
    }

  script(src = "/javascripts/geeksWeatherEvents.js")
    
  script.
    source.addEventListener('weather', function(e) {
      console.log('eventListener: weather: ', e);
      weather_data = JSON.parse(e.data);
      forecast = weather_data.forecast;

      var windRound = Math.round(weather_data.wind_mph);
      $("#today_high").text(     " H: " + forecast[0].high.fahrenheit);
      $("#today_low").text(      " L: " + forecast[0].low.fahrenheit);
      $("#wind").text(           " W: " + windRound);
      $("#cond").text(           weather_data.icon);
      console.log("Bengy - today's conditions icon: " + weather_data.icon + '.gif');
      $("#today").css('background-image', 'url(http://icons.wxug.com/i/c/h/' + weather_data.icon + '.gif)');

      
      $("#tmrw_high").text(      " H: " + forecast[1].high.fahrenheit);
      $("#tmrw_low").text(       " L: " + forecast[1].low.fahrenheit);
      $("#tmrw_wind").text(      " W: " + forecast[1].avewind.mph);
      $("#tmrw_cond").text(      forecast[1].conditions);
      $("#state").text(" Connected");
      $("#station").text("Station: " + weather_data.station);
      console.log("weather: ", weather_data);
      console.log("forecast: ", weather_data.forecast);
      console.log("Bengy - tomorrow's conditions icon: " + forecast[1].icon + '.gif');
      $("#tomorrow").css('background-image', 'url(http://icons.wxug.com/i/c/h/' + forecast[1].icon + '.gif)');
                                       
      $("#temp").text( " T: " + weather_data.temp_f);
      $("#rel_hum").text( " RH: " + weather_data.relative_humidity);
      $("#wind_dir").text( " WD: " + weather_data.wind_dir);
      $("#wind_mph").text( " WMPH: " + weather_data.wind_mph);
      $("#wind_gust").text( "WG: " + weather_data.wind_gust);
      $("#press_mb").text( " PM: " + weather_data.pressure_mb);
      $("#press_trend").text( " PT: " + weather_data.pressure_trend);
      $("#dewpoint").text( " DP: " + weather_data.dewpoint_f);
      $("#visibility").text( " VM: " + weather_data.visibility_mi);
      $("#prec_1h").text( " PH: " + weather_data.precip_1hr_in);
      $("#prec_todayInch").text( " PT: " + weather_data.precip_today_in);
      
      $("#moon_pctIllum").text( " MI: " + weather_data.moon_pctIllum);
      $("#moon_ageOfMoon").text( " MA: " + weather_data.moon_ageOfMoon);
      $("#moon_phaseofMoon").text( "MP: " + weather_data.moon_phaseofMoon);
      $("#moon_hemisphere").text( "MH: " + weather_data.moon_hemisphere);
      $("#moon_moonrise_hr").text( "MRH: " + weather_data.moon_moonrise_hr);
      $("#moon_moonrise_min").text( "MRM: " + weather_data.moon_moonrise_min);
      $("#moon_moonset_hr").text( "MSH: " + weather_data.moon_moonset_hr);
      $("#moon_moonset_min").text( "MSM: " + weather_data.moon_moonset_min);
      $("#sun_sunrise_hr").text( "SRH: " + weather_data.sun_sunrise_hr);
      $("#sun_sunrise_min").text( "SRM: " + weather_data.sun_sunrise_min);
      $("#sun_sunset_hr").text( "SSH: " + weather_data.sun_sunset_hr);
      $("#sun_sunset_min").text( "SSM: " + weather_data.sun_sunset_min); 

      //forecast Tomorrow
      $("#high ").text( "FH: " + forecast[0].high.fahrenheit);
      $("#low ").text( "FL: " + forecast[0].low.fahrenheit);
      $("#conditions ").text( "FC:  " + forecast[0].conditions);
      $("#icon ").text( "FI: " + forecast[0].icon);
      $("#pop ").text( "FP: " + forecast[0].pop);
      $("#qpf_allday ").text( "FA: " + forecast[0].qpf_allday.in);
      $("#qpf_day ").text( "FD: " + forecast[0].qpf_day.in);
      $("#qpf_night ").text( "FN: " + forecast[0].qpf_night.in);
      $("#snow_allday ").text( "SA: " + forecast[0].snow_allday.in);
      $("#snow_day ").text( "SD: " + forecast[0].snow_day.in);
      $("#snow_night ").text( "SN: " + forecast[0].snow_night.in);
      $("#maxWindDegrees ").text( "MW: " + forecast[0].maxwind.degrees);
      $("#maxWindDir ").text( "MD: " + forecast[0].maxwind.dir);
      $("#maxWindMph ").text( "MWM: " + forecast[0].maxwind.mph);
      $("#aveWindDegrees ").text( "AW: " + forecast[0].avewind.degrees);
      $("#aveWindDir ").text( "AD: " + forecast[0].avewind.dir);
      $("#aveWindMph ").text( "AWM: " + forecast[0].avewind.mph);
      $("#avehumidity ").text( "FU: " + forecast[0].avehumidity);
      $("#maxhumidity ").text( "MU: " + forecast[0].maxhumidity);
      $("#minhumidity ").text( "LU: " + forecast[0].minhumidity);
    }, false)


    source.addEventListener('error', function(e) {
      console.log('eventlistener: error: ', e)
      if(e.target.readyState == EventSource.CLOSED) {
        $("#temp_f").text("T");
        $("#today_high").text(     " H:");
        $("#today_low").text(      " L:");
        $("#wind").text(           " W:");
        $("#cond").text(           " C:");
        $("#tmrw_high").text(      " H:");
        $("#tmrw_low").text(       " L:");
        $("#tmrw_wind").text(      " W:");
        $("#tmrw_cond").text(      );
        $("#state").text(" Disconnected");
        $("#station").text(" Disconnected");
      } else if (e.target.readyState == EventSource.CONNECTING) {
        $("#temp_f").text("T");
        $("#today_high").text(     " H:");
        $("#today_low").text(      " L:");
        $("#wind").text(           " W:");
        $("#cond").text(           );
        $("#tmrw_high").text(      " H:");
        $("#tmrw_low").text(       " L:");
        $("#tmrw_wind").text(      " W:");
        $("#tmrw_cond").text(      );
        $("#state").text("Connecting...");
        $("#station").text("Station: Connecting...");
      } else {
        console.log("Your browser doesn't support SSE");
      }
    }, false)
